<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ============================================================ -->
    <!-- DASHBOARD PRINCIPAL MINIMALISTA                             -->
    <!-- ============================================================ -->
    
    <record id="view_repair_dashboard" model="ir.ui.view">
        <field name="name">repair.dashboard.form</field>
        <field name="model">mobile.repair.dashboard</field>
        <field name="arch" type="xml">
            <form string="Dashboard Reparaciones" create="false" edit="false" class="o_repair_dashboard">
                <header>
                    <button name="action_refresh" 
                            string="Actualizar" 
                            type="object" 
                            class="btn-primary"/>
                    
                    <button name="action_create_order" 
                            string="Nueva Orden" 
                            type="object" 
                            class="btn-success"/>
                </header>
                
                <sheet>
                    <!-- Título y filtros -->
                    <div class="oe_title o_mb_3">
                        <h1 class="text-primary">Dashboard de Reparaciones</h1>
                        <div class="row">
                            <div class="col-md-3">
                                <field name="date_from"/>
                            </div>
                            <div class="col-md-3">
                                <field name="date_to"/>
                            </div>
                        </div>
                    </div>
                    
                    <!-- KPIs Cards -->
                    <div class="row o_mb_4">
                        <div class="col-md-3">
                            <field name="total_orders" widget="statinfo" options="{'title': 'Total Órdenes'}"/>
                        </div>
                        <div class="col-md-3">
                            <field name="pending_orders" widget="statinfo" options="{'title': 'Pendientes'}"/>
                        </div>
                        <div class="col-md-3">
                            <field name="completed_today" widget="statinfo" options="{'title': 'Completadas Hoy'}"/>
                        </div>
                        <div class="col-md-3">
                            <field name="urgent_orders" widget="statinfo" options="{'title': 'Urgentes'}"/>
                        </div>
                    </div>
                    
                    <!-- Métricas Adicionales -->
                    <div class="row o_mb_4">
                        <div class="col-md-4">
                            <div class="card border-info text-center h-100">
                                <div class="card-body">
                                    <h4 class="text-info">
                                        <field name="revenue_month" widget="monetary"/>
                                    </h4>
                                    <p class="card-text text-muted o_mb_0">Ingresos del Mes</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card border-secondary text-center h-100">
                                <div class="card-body">
                                    <h4 class="text-secondary">
                                        <field name="avg_duration" widget="float" digits="[16,1]"/> días
                                    </h4>
                                    <p class="card-text text-muted o_mb_0">Duración Promedio</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card border-dark text-center h-100">
                                <div class="card-body">
                                    <p class="h6 text-dark o_mb_1">Técnico Destacado</p>
                                    <small class="text-muted">
                                        <field name="top_technician"/>
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gráficos -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title o_mb_0"><i class="fa fa-chart-bar me-1"></i> Órdenes por Estado</h5>
                                </div>
                                <div class="card-body">
                                    <div class="o_graph_container repair-states-chart-container">
                                        <canvas id="states_chart_canvas"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title o_mb_0"><i class="fa fa-chart-line me-1"></i> Actividad Diaria</h5>
                                </div>
                                <div class="card-body">
                                    <div class="o_graph_container daily-activity-chart-container">
                                        <canvas id="daily_chart_canvas"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Accesos Rápidos -->
                    <div class="row o_mt_4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title o_mb_0">Accesos Rápidos</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <button name="%(mobile_repair_orders.action_repair_orders_draft)d" type="action" class="btn btn-outline-secondary btn-block o_mb_2">
                                                Ver Recibidas
                                            </button>
                                        </div>
                                        <div class="col-md-3">
                                            <button name="%(mobile_repair_orders.action_repair_orders_in_progress)d" type="action" class="btn btn-outline-warning btn-block o_mb_2">
                                                En Reparación
                                            </button>
                                        </div>
                                        <div class="col-md-3">
                                            <button name="%(mobile_repair_orders.action_repair_orders_ready)d" type="action" class="btn btn-outline-success btn-block o_mb_2">
                                                Listas para Entrega
                                            </button>
                                        </div>
                                        <div class="col-md-3">
                                            <button name="%(mobile_repair_orders.action_repair_orders_all)d" type="action" class="btn btn-outline-primary btn-block o_mb_2">
                                                Todas las Órdenes
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </sheet>
                
                <!-- Campos ocultos -->
                <field name="currency_id" invisible="1"/>
            </form>
        </field>
    </record>
    
    <!-- ============================================================ -->
    <!-- ACCIÓN PRINCIPAL DEL DASHBOARD                              -->
    <!-- ============================================================ -->
    
    <record id="action_repair_dashboard" model="ir.actions.act_window">
        <field name="name">Dashboard Reparaciones</field>
        <field name="res_model">mobile.repair.dashboard</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_repair_dashboard"/>
        <field name="target">current</field>
        <field name="context">{}</field>
    </record>

</odoo>