<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ============================================================ -->
    <!-- DASHBOARD PRINCIPAL MINIMALISTA                             -->
    <!-- ============================================================ -->
    
    <record id="view_repair_dashboard" model="ir.ui.view">
        <field name="name">repair.dashboard.form</field>
        <field name="model">mobile.repair.dashboard</field>
        <field name="arch" type="xml">
            <form string="Dashboard Reparaciones" create="false" edit="false" class="o_repair_dashboard">
                <header>
                    <button name="action_refresh" 
                            string="Actualizar" 
                            type="object" 
                            class="btn-primary"/>
                    
                    <button name="action_create_order" 
                            string="Nueva Orden" 
                            type="object" 
                            class="btn-success"/>
                </header>
                
                <sheet class="o_dashboard_view">
                    <!-- Filtros de Período -->
                    <div class="o_dashboard_filter_container">
                        <div class="d-flex align-items-center mb-3">
                            <h2 class="o_page_title me-4">Dashboard de Reparaciones</h2>
                            <div class="d-flex">
                                <field name="date_from" class="me-2"/>
                                <field name="date_to"/>
                            </div>
                        </div>
                    </div>
                    
                    <!-- KPIs Principales usando widgets nativos de Odoo 18 -->
                    <div class="o_dashboard_kpis">
                        <div class="row g-3 mb-4">
                            <div class="col-lg-3 col-md-6">
                                <div class="o_kpi_card bg-white shadow-sm rounded border-0">
                                    <div class="card-body text-center">
                                        <div class="o_kpi_value">
                                            <field name="total_orders" widget="integer" class="text-primary fs-2 fw-bold"/>
                                        </div>
                                        <div class="o_kpi_label text-muted small">Total Órdenes</div>
                                        <div class="o_kpi_icon">
                                            <i class="fa fa-clipboard-list text-primary opacity-25"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-3 col-md-6">
                                <div class="o_kpi_card bg-white shadow-sm rounded border-0">
                                    <div class="card-body text-center">
                                        <div class="o_kpi_value">
                                            <field name="pending_orders" widget="integer" class="text-warning fs-2 fw-bold"/>
                                        </div>
                                        <div class="o_kpi_label text-muted small">Pendientes</div>
                                        <div class="o_kpi_icon">
                                            <i class="fa fa-clock text-warning opacity-25"></i>
                                        </div>
                                        <button name="action_view_pending" type="object" class="btn btn-sm btn-outline-warning mt-2">Ver</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-3 col-md-6">
                                <div class="o_kpi_card bg-white shadow-sm rounded border-0">
                                    <div class="card-body text-center">
                                        <div class="o_kpi_value">
                                            <field name="completed_today" widget="integer" class="text-success fs-2 fw-bold"/>
                                        </div>
                                        <div class="o_kpi_label text-muted small">Completadas Hoy</div>
                                        <div class="o_kpi_icon">
                                            <i class="fa fa-check-circle text-success opacity-25"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-3 col-md-6">
                                <div class="o_kpi_card bg-white shadow-sm rounded border-0">
                                    <div class="card-body text-center">
                                        <div class="o_kpi_value">
                                            <field name="urgent_orders" widget="integer" class="text-danger fs-2 fw-bold"/>
                                        </div>
                                        <div class="o_kpi_label text-muted small">Urgentes</div>
                                        <div class="o_kpi_icon">
                                            <i class="fa fa-exclamation-triangle text-danger opacity-25"></i>
                                        </div>
                                        <button name="action_view_urgent" type="object" class="btn btn-sm btn-outline-danger mt-2">Ver</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Métricas Financieras y Operativas -->
                    <div class="row g-3 mb-4">
                        <div class="col-lg-4">
                            <div class="card h-100 border-0 shadow-sm">
                                <div class="card-body text-center">
                                    <div class="mb-2">
                                        <i class="fa fa-money-bill-wave text-info fs-3 opacity-75"></i>
                                    </div>
                                    <h4 class="text-info mb-1">
                                        <field name="revenue_month" widget="monetary"/>
                                    </h4>
                                    <p class="text-muted small mb-0">Ingresos del Mes</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-4">
                            <div class="card h-100 border-0 shadow-sm">
                                <div class="card-body text-center">
                                    <div class="mb-2">
                                        <i class="fa fa-hourglass-half text-secondary fs-3 opacity-75"></i>
                                    </div>
                                    <h4 class="text-secondary mb-1">
                                        <field name="avg_duration" widget="float" digits="[16,1]"/> días
                                    </h4>
                                    <p class="text-muted small mb-0">Duración Promedio</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-4">
                            <div class="card h-100 border-0 shadow-sm">
                                <div class="card-body text-center">
                                    <div class="mb-2">
                                        <i class="fa fa-mobile-alt text-purple fs-3 opacity-75"></i>
                                    </div>
                                    <h6 class="text-purple mb-1">Dispositivo Más Reparado</h6>
                                    <p class="text-muted small mb-0">
                                        <field name="most_repaired_device"/>
                                    </p>
                                    <small class="text-muted">
                                        <field name="total_devices_repaired"/> tipos únicos
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sección de Accesos Rápidos con estilo nativo -->
                    <div class="o_dashboard_actions mb-4">
                        <h5 class="mb-3">Accesos Rápidos</h5>
                        <div class="row g-2">
                            <div class="col-lg-3 col-md-6">
                                <button name="%(mobile_repair_orders.action_repair_orders_draft)d" type="action" 
                                        class="btn btn-outline-secondary w-100 d-flex align-items-center justify-content-center">
                                    <i class="fa fa-inbox me-2"></i>
                                    <span>Recibidas</span>
                                </button>
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <button name="%(mobile_repair_orders.action_repair_orders_in_progress)d" type="action" 
                                        class="btn btn-outline-warning w-100 d-flex align-items-center justify-content-center">
                                    <i class="fa fa-wrench me-2"></i>
                                    <span>En Reparación</span>
                                </button>
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <button name="%(mobile_repair_orders.action_repair_orders_ready)d" type="action" 
                                        class="btn btn-outline-success w-100 d-flex align-items-center justify-content-center">
                                    <i class="fa fa-check me-2"></i>
                                    <span>Listas</span>
                                </button>
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <button name="%(mobile_repair_orders.action_repair_orders_all)d" type="action" 
                                        class="btn btn-outline-primary w-100 d-flex align-items-center justify-content-center">
                                    <i class="fa fa-list me-2"></i>
                                    <span>Todas</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sección de Análisis Rápidos -->
                    <div class="o_dashboard_analytics mb-4">
                        <h5 class="mb-3">Análisis Detallado</h5>
                        <div class="row g-2">
                            <div class="col-lg-4 col-md-6">
                                <button name="%(mobile_repair_orders.action_repair_orders_monthly_analysis)d" type="action" 
                                        class="btn btn-outline-info w-100 d-flex align-items-center justify-content-center">
                                    <i class="fa fa-chart-line me-2"></i>
                                    <span>Análisis Mensual</span>
                                </button>
                            </div>
                            <div class="col-lg-4 col-md-6">
                                <button name="%(mobile_repair_orders.action_repair_orders_technician_analysis)d" type="action" 
                                        class="btn btn-outline-success w-100 d-flex align-items-center justify-content-center">
                                    <i class="fa fa-chart-bar me-2"></i>
                                    <span>Por Técnico</span>
                                </button>
                            </div>
                            <div class="col-lg-4 col-md-6">
                                <button name="%(mobile_repair_orders.action_repair_orders_devices_analysis)d" type="action" 
                                        class="btn btn-outline-purple w-100 d-flex align-items-center justify-content-center">
                                    <i class="fa fa-mobile-alt me-2"></i>
                                    <span>Por Dispositivos</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gráficos usando Graph View nativo -->
                    <div class="row g-3">
                        <div class="col-lg-6">
                            <div class="card border-0 shadow-sm h-100">
                                <div class="card-header bg-transparent border-0">
                                    <h6 class="card-title mb-0">
                                        <i class="fa fa-chart-line me-2 text-primary"></i>
                                        Órdenes por Mes (Últimos 12 meses)
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="o_graph_container" style="height: 300px;">
                                        <button name="action_view_monthly_analysis" type="object" 
                                                class="btn btn-light w-100 h-100 d-flex flex-column align-items-center justify-content-center">
                                            <i class="fa fa-chart-line fa-3x text-primary mb-3"></i>
                                            <h6>Ver Análisis Mensual</h6>
                                            <small class="text-muted">Gráfico interactivo de tendencias</small>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-6">
                            <div class="card border-0 shadow-sm h-100">
                                <div class="card-header bg-transparent border-0">
                                    <h6 class="card-title mb-0">
                                        <i class="fa fa-chart-bar me-2 text-success"></i>
                                        Órdenes por Técnico
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="o_graph_container" style="height: 300px;">
                                        <button name="action_view_technician_analysis" type="object" 
                                                class="btn btn-light w-100 h-100 d-flex flex-column align-items-center justify-content-center">
                                            <i class="fa fa-chart-bar fa-3x text-success mb-3"></i>
                                            <h6>Ver Análisis por Técnico</h6>
                                            <small class="text-muted">Productividad y rendimiento</small>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Nueva fila para dispositivos más reparados -->
                    <div class="row g-3 mt-3">
                        <div class="col-lg-8">
                            <div class="card border-0 shadow-sm h-100">
                                <div class="card-header bg-transparent border-0">
                                    <h6 class="card-title mb-0">
                                        <i class="fa fa-mobile-alt me-2 text-info"></i>
                                        Dispositivos Más Reparados (Top 10)
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="o_graph_container" style="height: 300px;">
                                        <button name="action_view_devices_analysis" type="object" 
                                                class="btn btn-light w-100 h-100 d-flex flex-column align-items-center justify-content-center">
                                            <i class="fa fa-mobile-alt fa-3x text-info mb-3"></i>
                                            <h6>Ver Dispositivos Más Reparados</h6>
                                            <small class="text-muted">Ranking de marcas y modelos</small>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-4">
                            <div class="card border-0 shadow-sm h-100">
                                <div class="card-header bg-transparent border-0">
                                    <h6 class="card-title mb-0">
                                        <i class="fa fa-user-tie me-2 text-warning"></i>
                                        Técnico Destacado
                                    </h6>
                                </div>
                                <div class="card-body d-flex align-items-center justify-content-center">
                                    <div class="text-center">
                                        <div class="mb-3">
                                            <i class="fa fa-trophy text-warning fa-3x"></i>
                                        </div>
                                        <h6 class="text-warning mb-2">Mejor Rendimiento</h6>
                                        <p class="text-muted small mb-0">
                                            <field name="top_technician"/>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </sheet>
                
                <!-- Campos ocultos -->
                <field name="currency_id" invisible="1"/>
            </form>
        </field>
    </record>
    
    <!-- ============================================================ -->
    <!-- ACCIÓN PRINCIPAL DEL DASHBOARD                              -->
    <!-- ============================================================ -->
    
    <record id="action_repair_dashboard" model="ir.actions.act_window">
        <field name="name">Dashboard Reparaciones</field>
        <field name="res_model">mobile.repair.dashboard</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_repair_dashboard"/>
        <field name="target">current</field>
        <field name="context">{'form_view_initial_mode': 'readonly'}</field>
    </record>
    
    <!-- Acción para abrir dashboard directamente -->
    <record id="action_open_dashboard" model="ir.actions.server">
        <field name="name">Abrir Dashboard</field>
        <field name="model_id" ref="model_mobile_repair_dashboard"/>
        <field name="state">code</field>
        <field name="code">
dashboard = env['mobile.repair.dashboard'].create({})
action = env.ref('mobile_repair_orders.action_repair_dashboard').read()[0]
action['res_id'] = dashboard.id
        </field>
    </record>

</odoo>